# PAI Customization Manifest
# Purpose: Explicitly define which files contain YOUR customizations
# Usage: Referenced by sync scripts to protect your work during upstream merges

version: "1.0"
created: "2026-01-19"
description: "Files that contain YOUR customizations - protect during upstream sync"

# =============================================================================
# TIER 1: NEVER MERGE
# Your identity, personal data, and memories - ALWAYS keep local version
# =============================================================================
never_merge:
  description: "Sacred files - upstream changes are NEVER accepted"

  directories:
    # Your identity and personalization
    - "Releases/v2.3/.claude/skills/CORE/USER/"
    - "Releases/v2.3/.claude/USER/"

    # Your learning and memory
    - "Releases/v2.3/.claude/MEMORY/"
    - "Releases/v2.3/.claude/History/"
    - "Releases/v2.3/.claude/SESSIONS/"

    # Pack USER directories
    - "Packs/pai-core-install/src/skills/CORE/USER/"

  files:
    # Credentials and secrets
    - ".env"
    - ".env.local"
    - ".env.production"

    # Identity configuration
    - "settings.json"
    - "Releases/v2.3/.claude/settings.json"

  patterns:
    - "**/USER/**"
    - "**/MEMORY/**"
    - "**/History/**"
    - "**/.env*"
    - "**/ratings.jsonl"
    - "**/LEARNINGS/**"

# =============================================================================
# TIER 2: SELECTIVE MERGE
# Infrastructure you may have customized - review diffs before accepting
# =============================================================================
selective_merge:
  description: "Review upstream changes against your modifications"

  files:
    # Hooks you may have customized
    - "Releases/v2.3/.claude/hooks/*.ts"
    - "Releases/v2.3/.claude/hooks/handlers/*.ts"

    # Skill definitions you may have enhanced
    - "Releases/v2.3/.claude/skills/*/SKILL.md"

    # System files you may have tweaked
    - "Releases/v2.3/.claude/skills/CORE/SYSTEM/*.md"

  review_strategy: |
    For each file in selective_merge:
    1. Compare your version with upstream: git diff main:file upstream/main:file
    2. Identify upstream improvements worth keeping
    3. Cherry-pick specific changes rather than wholesale replacement
    4. Test after any merge

# =============================================================================
# TIER 3: AUTO-MERGE
# Pure upstream content - safe to update automatically
# =============================================================================
auto_merge:
  description: "Files you haven't customized - accept upstream changes"

  directories:
    # New packs and tools
    - "Packs/"
    - "Tools/"

    # Documentation
    - "Plans/"
    - "docs/"

  files:
    # Root documentation (unless you've customized)
    - "README.md"
    - "INSTALL.md"
    - "SECURITY.md"
    - "CONTRIBUTING.md"

    # Validation tooling
    - "Tools/validate-protected.ts"
    - ".pai-protected.json"

  notes: |
    Even for auto-merge files, review the diff to understand what changed.
    New Packs may require installation steps.
    Tool updates may have new dependencies.

# =============================================================================
# YOUR SPECIFIC CUSTOMIZATIONS
# Document what you've personalized for easy reference
# =============================================================================
your_customizations:
  identity:
    - path: "Releases/v2.3/.claude/skills/CORE/USER/ABOUTME.md"
      purpose: "Your personal background and expertise"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/BASICINFO.md"
      purpose: "Name, timezone, location"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/RESUME.md"
      purpose: "Professional history"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/DAIDENTITY.md"
      purpose: "Your AI's personality and voice"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/CONTACTS.md"
      purpose: "People your AI knows about"

  life_os_telos:
    - path: "Releases/v2.3/.claude/skills/CORE/USER/TELOS/"
      purpose: "Your complete life operating system"
      files:
        - "BELIEFS.md - Core beliefs and values"
        - "GOALS.md - What you're working toward"
        - "MISSION.md - Your life mission"
        - "STRATEGIES.md - How you approach problems"
        - "PROJECTS.md - Active projects"
        - "PROBLEMS.md - Challenges you're solving"
        - "WISDOM.md - Accumulated insights"
        - "LEARNED.md - Lessons learned"
        - "MODELS.md - Mental models you use"
        - "FRAMES.md - How you frame situations"

  preferences:
    - path: "Releases/v2.3/.claude/skills/CORE/USER/TECHSTACKPREFERENCES.md"
      purpose: "Technology choices and preferences"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/ALGOPREFS.md"
      purpose: "Algorithm and methodology preferences"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/RESPONSEFORMAT.md"
      purpose: "How you want responses formatted"

  skills:
    - path: "Releases/v2.3/.claude/skills/CORE/USER/SKILLCUSTOMIZATIONS/"
      purpose: "Per-skill preference overrides"
      examples:
        - "Art/CharacterSpecs.md - Art generation preferences"
        - "Art/SceneConstruction.md - Scene building preferences"
        - "Art/PREFERENCES.md - General art preferences"

  context:
    - path: "Releases/v2.3/.claude/skills/CORE/USER/ARCHITECTURE.md"
      purpose: "Your systems and architecture knowledge"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/DEFINITIONS.md"
      purpose: "Terms and definitions you use"
    - path: "Releases/v2.3/.claude/skills/CORE/USER/CORECONTENT.md"
      purpose: "Content you reference frequently"

# =============================================================================
# PERSONAL SKILLS (Community Practice from Discussion #435)
# Skills using _ALLCAPS naming convention are YOURS and never sync
# =============================================================================
personal_skills:
  description: "Custom skills that should never sync with upstream"
  naming_convention: "_ALLCAPS prefix (e.g., _MYSKILL, _WORKFLOWS)"

  directories:
    - "skills/_*"                    # Any skill starting with underscore
    - "skills/_PERSONALSKILLS/"      # Dedicated personal skills folder
    - "Releases/v2.3/.claude/skills/_*"

  creation_pattern: |
    To create a personal skill that never syncs:
    1. Name it with _ALLCAPS: skills/_MYRESEARCH/
    2. Add SKILL.md, Workflows/, etc. as normal
    3. It will be ignored by upstream sync automatically

# =============================================================================
# CHAIN-LOADING PATTERN (Community Practice)
# Extend SYSTEM files without modifying them
# =============================================================================
chain_loading:
  description: "How to extend functionality without touching SYSTEM files"

  entry_point: "SKILLCUSTOMIZATIONS/{SkillName}/PREFERENCES.md"
  reason: "Skills auto-load PREFERENCES.md, use it to chain-load your extensions"

  example: |
    # In SKILLCUSTOMIZATIONS/Research/PREFERENCES.md
    When executing research, also load:
    - SKILLCUSTOMIZATIONS/Research/Workflows/DeepDive.md
    - SKILLCUSTOMIZATIONS/Research/Sources.md

  benefits:
    - "SYSTEM files stay pristine for upstream updates"
    - "Your extensions load automatically"
    - "No merge conflicts on SYSTEM files"

# =============================================================================
# KNOWLEDGE BASE (Community Practice)
# Your personal knowledge outside skill structure
# =============================================================================
knowledge_base:
  location: "USER/kb/"
  structure:
    - "USER/kb/domains/"      # Domain-specific knowledge
    - "USER/kb/projects/"     # Project context
    - "USER/kb/reference/"    # Reference materials
  protection: "never_merge"

# =============================================================================
# PLATFORM COMPATIBILITY (Linux-specific)
# Some PAI tools assume macOS paths
# =============================================================================
platform_fixes:
  description: "Files that may need Linux path corrections"
  issue: "Some tools hardcode /Users/ (macOS) instead of /home/ (Linux)"

  detection_command: |
    grep -rn "/Users/" ~/.claude/skills/*/Tools/*.ts 2>/dev/null

  files_to_check:
    - "skills/*/Tools/*.ts"
    - "hooks/*.ts"
    - "Tools/*.ts"

  pattern_to_fix: "/Users/"
  replacement: "${HOME}/"

# =============================================================================
# MIGRATION CHECKLIST (Community Practice from Discussion #435)
# What to preserve vs skip when migrating PAI versions
# =============================================================================
migration:
  preserve:
    critical:
      - "skills/CORE/USER/"
      - "skills/_*/"                    # Personal skills
      - "USER/kb/"                      # Knowledge base
      - "MEMORY/SIGNALS/ratings.jsonl"  # Learning signal
      - ".env"                          # Secrets
    important:
      - "MEMORY/LEARNING/"
      - "MEMORY/RESEARCH/"
      - "SKILLCUSTOMIZATIONS/"
      - "Agent personalities"
      - "Custom workflows"

  skip:
    description: "Regeneratable or fresh-install items"
    items:
      - "raw-outputs/"           # Regeneratable
      - "node_modules/"          # Reinstall fresh
      - "Hook-captured summaries" # SessionHarvester regenerates
      - "Build artifacts"
      - "Cache directories"
      - "Log files"
      - "Temporary work files"

# =============================================================================
# SYNC CONFIGURATION
# Settings for the sync-upstream.sh script
# =============================================================================
sync_settings:
  # Upstream repository
  upstream_url: "https://github.com/danielmiessler/PAI.git"
  upstream_branch: "main"

  # Your main branch
  local_branch: "main"

  # Branch naming for integration
  integration_branch_prefix: "upstream-merge/"

  # Backup settings
  backup_before_sync: true
  backup_directory: "~/pai-backups"
  backup_retention_days: 30

  # Notification settings
  notify_on_upstream_changes: true
  auto_merge_enabled: false  # Recommend manual review

# =============================================================================
# ENVIRONMENT SEPARATION (Critical Practice)
# API keys belong in .env, NOT settings.json
# =============================================================================
environment:
  secrets_location: "~/.claude/.env"
  never_in_settings_json:
    - "ANTHROPIC_API_KEY"
    - "OPENAI_API_KEY"
    - "PERPLEXITY_API_KEY"
    - "ELEVENLABS_API_KEY"
    - "Any *_API_KEY"
    - "Any *_SECRET"
    - "Any *_TOKEN"

  reason: |
    PAI v2.3 expects API keys in ~/.claude/.env, NOT in settings.json.
    This ensures:
    1. Secrets never accidentally commit
    2. settings.json can safely sync
    3. .env is in .gitignore by default
